{% extends "base.html" %}

{% block title %}Conversation{% endblock %}

{% block content %}
<div class="card">
    <h1 class="page-title">
        Conversation with {{ other.first_name }} {{ other.last_name }}
    </h1>
    <section id="messages-container">
        {% include "messaging/partials/messages_list.html" %}
    </section>
</div>

<div class="card">
    <h2 class="page-title">Send message</h2>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Send</button>
    </form>
</div>

<script>
    function refreshMessages() {
        fetch("{% url 'messaging:messages_partial' conversation.pk %}")
            .then(function (response) {
                return response.text();
            })
            .then(function (html) {
                var container = document.getElementById("messages-container");
                if (container) {
                    container.innerHTML = html;
                    if (typeof applyTextDirection === "function") {
                        applyTextDirection(container);
                    }
                }
            })
            .catch(function () {});
    }

    setInterval(refreshMessages, 5000);
</script>
{% endblock %}
